{"title": "Calculate Median", "metric_query": "SET @row_index := -1; SELECT AVG(subq.median_field) as result FROM ( SELECT @row_index:=@row_index + 1 AS row_index, {var__model_field} as median_field FROM {var__trp_table} WHERE {CORE_FILTERS} and {TRP_FILTERS} ORDER BY {var__model_field} ) AS subq WHERE subq.row_index IN (FLOOR(@row_index / 2) , CEIL(@row_index / 2));", "group_by_1_query": "SET @row_index := -1; SELECT subq.vg1, AVG(subq.median_field) as result FROM ( SELECT {var__group_by_1} as vg1,{var__model_field} as median_field, @row_index:=@row_index + 1 AS row_index FROM {var__trp_table} WHERE ((1 = 1 AND source_id =303 AND 1 = 1 AND deleted is NULL)) and (1 = 1) group by vg1, median_field ) AS subq WHERE subq.row_index IN (FLOOR(@row_index / 2) , CEIL(@row_index / 2)) group by subq.vg1;", "group_by_2_query": "SET @row_index := -1; SELECT subq.vg1,subq.vg2, AVG(subq.median_field) as result FROM ( SELECT {var__group_by_1} as vg1, {var__group_by_2} as vg2, {var__model_field} as median_field, @row_index:=@row_index + 1 AS row_index FROM {var__trp_table} WHERE ((1 = 1 AND source_id =303 AND 1 = 1 AND deleted is NULL)) and (1 = 1) group by vg1, vg2, median_field ) AS subq WHERE subq.row_index IN (FLOOR(@row_index / 2) , CEIL(@row_index / 2)) group by subq.vg1, subq.vg2;", "sql_query_config": "{\"var__trp_table\": {\"aspect\": \"TRP_TABLE\"}, \"var__model_field\": {\"aspect\": \"USER_INPUT\", \"type\": \"ModelField\", \"label\": \"Median Off\"}, \"var__group_by_1\": {\"aspect\": \"TRP_GROUP_1\"}, \"var__group_by_2\": {\"aspect\": \"TRP_GROUP_2\"}}", "dw_name": "mysql"}